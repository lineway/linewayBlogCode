---
title: git服务器
date: 2019-04-10 16:35:59
tags: git
categories: git
---

# git服务器

市面上有很多的第三方代码托管服务，有名的如`github.com`，提供了完整的代码托管功能。但是我们有时候需要在组织内部假设git服务器进行代码托管，这部分主要介绍git服务器相关的内容。

# 协议

git支持四种协议来传输资料，分别是：本地协议（Local）、HTTP(S)协议、SSH(Secure Shell)协议及GIt协议。

## 本地协议

最基本的协议就是*本地协议(Local protocol)*，其中远程版本库就是硬盘内的一个目录。这种配置常见于组织内部成员都对一个共享目录有访问权限。

这种情况下，本地版本库从远程版本库克隆、推送及拉取文件时，则使用远程版本库的路径作为URL即可，如：

```bash
git clone /opt/git/project.git
# 或者使用
git clone file:///opt/git/project.git
```

两者的区别是，如果不指定`file://`那么git会尝试使用硬链接或直接复制所需要的文件；如果指定`file://`，那么git会使用网络传输资料的方式，可能存在传输效率低的问题。

本地协议的优点是：使用简单，可以直接复用已有的文件共享权限和网络访问权限，直接在共享文件系统中放置一个裸版本库，设置好读/写权限即可。

但是这种方式也存在一定的缺点，如：共享文件相对于网络连接访问更难配置，且不方便从多个位置访问，如果需要在组织外部，则无法直接访问到版本仓库。还需要注意的是，共享组的每一个用户都拥有版本仓库的完整权限，无法限制共享组内成员对git内部文件及仓库的修改操作。

## HTTP(S)协议

git在使用HTTP协议的时候，有两种通信模式。一种叫做智能HTTP协议，一种叫做哑HTTP协议。

### 智能HTTP协议

智能HTTP协议的运行方式和SSH及GIt协议类似，只是运行在标准的HTTP端口，并且可以使用各种HTTP验证机制。它支持像`git://`协议一样的匿名服务，也支持像SSH一样提供传输时的授权和加密。并且，它只需要一个URL就可以做到上述功能。

如果使用`github`，那么就可以体验智能HTTP协议的实际使用情况。

### 哑HTTP协议

在哑HTTP协议中，web服务器仅把裸版本库当做普通文件对待，提供文件服务。它的优点是设置起来简单。在实际使用中，如果配置哑HTTP协议，只需要把一个裸版本库放在HTTP目录，设置一个叫做`post-update`的钩子，然后就可以访问web服务器上的版本库以及克隆版本库。